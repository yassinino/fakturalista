import{r as b,e as R,f as C,A as T,o as u,c as v,i as E,w as B,b as e,t as l,l as g,v as L,n as w,j as f,G as z,d as A,k as D,x as V,y as j,z as O,J as G}from"./main-d368e171.js";const I={class:"content content-boxed"},J=["onSubmit"],W={class:"row push"},q={class:"col-lg-4"},H={class:"fs-sm text-muted"},K={class:"col-lg-8 col-xl-5"},Q={class:"mb-4"},X={class:"form-label",for:"one-profile-edit-name"},Y=["placeholder","disabled"],Z={key:0,class:"invalid-feedback"},x={class:"mb-4"},ee={class:"form-label",for:"one-profile-edit-email"},se=["placeholder","disabled"],oe={key:0,class:"invalid-feedback"},ae={class:"mb-4"},le={class:"form-label",for:"one-profile-edit-locale"},te=["disabled"],ie={value:"es"},re={value:"en"},ne={value:"fr"},de={key:0,class:"invalid-feedback"},ce={class:"mb-4"},pe={class:"form-label"},ue={class:"mb-4"},ve=["src"],fe={class:"mb-4"},me={for:"one-profile-edit-avatar",class:"form-label"},_e=["disabled"],be={key:0,class:"invalid-feedback"},we={class:"mb-4"},he=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},ge=["onSubmit"],ke={class:"row push"},$e={class:"col-lg-4"},Pe={class:"fs-sm text-muted"},Ue={class:"col-lg-8 col-xl-5"},Le={class:"mb-4"},Se={class:"form-label",for:"one-profile-edit-password"},Ve=["disabled"],Ce={key:0,class:"invalid-feedback"},Ee={class:"row mb-4"},Be={class:"col-12"},Ae={class:"form-label",for:"one-profile-edit-password-new"},De=["disabled"],je={key:0,class:"invalid-feedback"},Fe={class:"row mb-4"},Me={class:"col-12"},Ne={class:"form-label",for:"one-profile-edit-password-new-confirm"},Re=["disabled"],Te={key:0,class:"invalid-feedback"},ze={class:"mb-4"},Oe=["disabled"],Ge={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},qe={__name:"profile",setup(Ie){const k=G({}),$="/assets/media/avatars/avatar13.jpg",S=b($),P=b(null),{t:U}=R(),r=C({name:"",email:"",locale:"es"}),n=C({current_password:"",password:"",password_confirmation:""}),i=b({}),c=b({}),m=b(!1),_=b(!1),h=b(!0),y=s=>{var a;(a=S.value)!=null&&a.startsWith("blob:")&&URL.revokeObjectURL(S.value),S.value=s||$};T(async()=>{var s,a,p,t,d;h.value=!0,i.value={};try{const{data:o}=await V.get("/user");r.name=((s=o==null?void 0:o.user)==null?void 0:s.name)??"",r.email=((a=o==null?void 0:o.user)==null?void 0:a.email)??"",r.locale=((p=o==null?void 0:o.user)==null?void 0:p.locale)??"es",(t=o==null?void 0:o.user)!=null&&t.locale&&j(o.user.locale),(d=o==null?void 0:o.user)!=null&&d.avatar_url?y(o.user.avatar_url):P.value||y($)}catch{k.error(U("notifications.profileLoadError"))}finally{h.value=!1}});const F=s=>{const[a]=s.target.files||[];P.value=a||null,y(a?URL.createObjectURL(a):$)},M=async()=>{var s,a,p,t;m.value=!0,i.value={};try{const d=new FormData;d.append("_method","put"),d.append("name",r.name??""),d.append("email",r.email??""),d.append("locale",r.locale??"es"),P.value&&d.append("avatar",P.value);const{data:o}=await V.post("/user",d,{headers:{"Content-Type":"multipart/form-data"}});k.success(U("notifications.profileUpdateSuccess")),j(((s=o==null?void 0:o.user)==null?void 0:s.locale)??r.locale??"es"),P.value=null,(a=o==null?void 0:o.user)!=null&&a.avatar_url?y(o.user.avatar_url):y($),o!=null&&o.user&&window.dispatchEvent(new CustomEvent("user-profile-updated",{detail:{user:o.user}}))}catch(d){if(((p=d.response)==null?void 0:p.status)===422){i.value=((t=d.response.data)==null?void 0:t.errors)||{};return}k.error(U("notifications.profileUpdateError"))}finally{m.value=!1}},N=async()=>{var s,a;_.value=!0,c.value={};try{await V.post("/user",{_method:"put",current_password:n.current_password,password:n.password,password_confirmation:n.password_confirmation}),k.success(U("notifications.passwordUpdateSuccess")),n.current_password="",n.password="",n.password_confirmation=""}catch(p){if(((s=p.response)==null?void 0:s.status)===422){c.value=((a=p.response.data)==null?void 0:a.errors)||{};return}k.error(U("notifications.passwordUpdateError"))}finally{_.value=!1}};return(s,a)=>{const p=O("BaseBlock");return u(),v("div",I,[E(p,{title:s.$t("profile.title")},{default:B(()=>[e("form",{onSubmit:D(M,["prevent"])},[e("div",W,[e("div",q,[e("p",H,l(s.$t("profile.description")),1)]),e("div",K,[e("div",Q,[e("label",X,l(s.$t("profile.nameLabel")),1),g(e("input",{type:"text",class:w(["form-control",{"is-invalid":i.value.name}]),id:"one-profile-edit-name",name:"one-profile-edit-name",placeholder:s.$t("profile.namePlaceholder"),"onUpdate:modelValue":a[0]||(a[0]=t=>r.name=t),disabled:h.value||m.value},null,10,Y),[[L,r.name]]),i.value.name?(u(),v("div",Z,l(i.value.name[0]),1)):f("",!0)]),e("div",x,[e("label",ee,l(s.$t("profile.emailLabel")),1),g(e("input",{type:"email",class:w(["form-control",{"is-invalid":i.value.email}]),id:"one-profile-edit-email",name:"one-profile-edit-email",placeholder:s.$t("profile.emailPlaceholder"),"onUpdate:modelValue":a[1]||(a[1]=t=>r.email=t),disabled:h.value||m.value},null,10,se),[[L,r.email]]),i.value.email?(u(),v("div",oe,l(i.value.email[0]),1)):f("",!0)]),e("div",ae,[e("label",le,l(s.$t("profile.languageLabel")),1),g(e("select",{id:"one-profile-edit-locale",name:"one-profile-edit-locale",class:w(["form-select",{"is-invalid":i.value.locale}]),"onUpdate:modelValue":a[2]||(a[2]=t=>r.locale=t),disabled:h.value||m.value},[e("option",ie,l(s.$t("languages.es")),1),e("option",re,l(s.$t("languages.en")),1),e("option",ne,l(s.$t("languages.fr")),1)],10,te),[[z,r.locale]]),i.value.locale?(u(),v("div",de,l(i.value.locale[0]),1)):f("",!0)]),e("div",ce,[e("label",pe,l(s.$t("profile.avatarLabel")),1),e("div",ue,[e("img",{class:"img-avatar",src:S.value,alt:""},null,8,ve)]),e("div",fe,[e("label",me,l(s.$t("profile.avatarChoose")),1),e("input",{class:w(["form-control",{"is-invalid":i.value.avatar}]),type:"file",id:"one-profile-edit-avatar",accept:"image/*",onChange:F,disabled:m.value},null,42,_e),i.value.avatar?(u(),v("div",be,l(i.value.avatar[0]),1)):f("",!0)])]),e("div",we,[e("button",{type:"submit",class:"btn btn-alt-primary",disabled:m.value||h.value},[m.value?(u(),v("span",ye)):f("",!0),A(" "+l(s.$t("profile.save")),1)],8,he)])])])],40,J)]),_:1},8,["title"]),E(p,{title:s.$t("profile.passwordTitle")},{default:B(()=>[e("form",{onSubmit:D(N,["prevent"])},[e("div",ke,[e("div",$e,[e("p",Pe,l(s.$t("profile.passwordDescription")),1)]),e("div",Ue,[e("div",Le,[e("label",Se,l(s.$t("profile.currentPassword")),1),g(e("input",{type:"password",class:w(["form-control",{"is-invalid":c.value.current_password}]),id:"one-profile-edit-password",name:"one-profile-edit-password","onUpdate:modelValue":a[3]||(a[3]=t=>n.current_password=t),disabled:_.value},null,10,Ve),[[L,n.current_password]]),c.value.current_password?(u(),v("div",Ce,l(c.value.current_password[0]),1)):f("",!0)]),e("div",Ee,[e("div",Be,[e("label",Ae,l(s.$t("profile.newPassword")),1),g(e("input",{type:"password",class:w(["form-control",{"is-invalid":c.value.password}]),id:"one-profile-edit-password-new",name:"one-profile-edit-password-new","onUpdate:modelValue":a[4]||(a[4]=t=>n.password=t),disabled:_.value},null,10,De),[[L,n.password]]),c.value.password?(u(),v("div",je,l(c.value.password[0]),1)):f("",!0)])]),e("div",Fe,[e("div",Me,[e("label",Ne,l(s.$t("profile.confirmPassword")),1),g(e("input",{type:"password",class:w(["form-control",{"is-invalid":c.value.password_confirmation}]),id:"one-profile-edit-password-new-confirm",name:"one-profile-edit-password-new-confirm","onUpdate:modelValue":a[5]||(a[5]=t=>n.password_confirmation=t),disabled:_.value},null,10,Re),[[L,n.password_confirmation]]),c.value.password_confirmation?(u(),v("div",Te,l(c.value.password_confirmation[0]),1)):f("",!0)])]),e("div",ze,[e("button",{type:"submit",class:"btn btn-alt-primary",disabled:_.value},[_.value?(u(),v("span",Ge)):f("",!0),A(" "+l(s.$t("profile.save")),1)],8,Oe)])])])],40,ge)]),_:1},8,["title"])])}}};export{qe as default};
